apiVersion: batch/v1
kind: Job
metadata:
  name: enable-test-signing
  namespace: default
spec:
  template:
    spec:
      hostNetwork: true  # Required for HostProcess
      nodeSelector:
        kubernetes.io/os: windows
      securityContext:
        windowsOptions:
          hostProcess: true
          runAsUserName: "NT AUTHORITY\\SYSTEM"
      containers:
      - name: enable-test-signing-container
        image: mcr.microsoft.com/windows/servercore:ltsc2022
        command:
        - powershell.exe
        - -command
        - |
          Write-Host "Test-Signing enabled."
          bcdedit /set testsigning on
          Start-Sleep -Seconds 5
          shutdown.exe /r /t 5 /f